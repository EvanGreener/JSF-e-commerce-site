<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:bookstore="http://java.sun.com/jsf/composite/default_components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>
        <title>Manager Sales</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&amp;display=swap" rel="stylesheet"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <h:outputStylesheet library="webjars" name="Semantic-UI/2.4.1/semantic.min.css" />
        <h:outputStylesheet library="webjars" name="swiper/4.5.1/dist/css/swiper.min.css" />
        <h:outputStylesheet library="css" name="default.css" />
        <h:outputStylesheet library="modalCss" name="modal.css" />
        <h:outputStylesheet library="managercss" name="manager.css" />
        <h:outputScript library="webjars" name="Semantic-UI/2.4.1/semantic.min.js"/>
               <style>

               .modal{
                    position: fixed;
                    padding-top: 0px;
                    height: fit-content;
                    text-align: center;
                    font-size: 18px;
               }

               .middle h1 {
                    margin-top: 20px !important;
                    text-align: center;
                    color: gray;
               }
               .middle{
                    padding: 0px 40px 0px 40px;
               }

               .actions{
                    height: 80%;
                    text-align: center !important;
                    font-size: 20px;
                    margin: 10px 10px 10px 10px;
               }

               .actions .ui.button {
                    margin: 10px 10px 10px 10px;
               }

               .footer button{
                    font-size: 20px !important;
                    margin: 0px 10px 0px 10px !important;
               }

               .header h1 {
                    text-align: center !important;
               }

               /*               .content h3 {
                                   
                              }*/

               .form-field{
                    font-size: 18px;
                    margin: 10px 0px 10px 5px;

               }

               #editFormGrowl{
                    position: fixed;
                    display: none;
                    z-index: 777;
                    left: 100%;
                    margin-left: -257.42px;


               }
               </style>
    </h:head>

    <h:body>

        <h:form id="editForm">
            <bookstore:navbar />

            <div class="middle">

                <h1 class="ui header">Sales Management</h1>
                
                <br/>
                
                <h:commandButton value="Only Show Sales">
                    <f:ajax event="click" listener="#{salesBean.setBooksDisplayed(bookJpaController.allSaleBooks)}" />
                </h:commandButton>
                <h:commandButton value="Show All Books">
                    <f:ajax event="click" listener="#{salesBean.setBooksDisplayed(bookJpaController.findBookEntities())}" />
                </h:commandButton>

                <h:dataTable id="saleTable" var="sales" style="margin-bottom: 20px;" class="ui celled table" value="#{salesBean.booksDisplayed}">
                    <h:column>
                        <f:facet name="header">ISBN</f:facet>
                            #{sales.isbn}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Title</f:facet>
                            #{sales.title}
                    </h:column>
                    <h:column>
                        <f:facet name="header">List</f:facet>
                            $#{sales.listPrice}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Sale</f:facet>
                            $#{sales.salePrice}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Wholesale</f:facet>
                            $#{sales.wholesalePrice}
                    </h:column>
                    <h:column>
                        <f:facet name="header">Status</f:facet>
                            #{salesBean.determineOnSale(sales)}
                    </h:column>
                    <h:column>
                        <h:commandButton type="button" value="Edit Sale" onclick="setTimeout(function () {
                                    $('#editModal').modal('show', hideGrowl())
                                }, 500)" class="big ui primary button edit_btn" >
                            <f:ajax event="click" render="@all" listener="#{salesBean.onEdit(sales.isbn)}" />
                        </h:commandButton>
                    </h:column>
                </h:dataTable>
            </div>
            <bookstore:footer />
        </h:form>

        <div id="editModal" class="small ui modal">
            <div class="header">
                <h1>Edit Book</h1>
            </div>
            <div class="content">
                <h:form id="editSaleForm" class="ui form">
                    <div class="three fields">
                        <div class="field">
                            <h:outputLabel for="listPrice" value="List Price"/>
                            <h:outputText id="listPrice" value="#{salesBean.currentBook.listPrice}" />
                        </div>
                        <div class="field">
                            <h:outputLabel for="oldSalePrice" value="Old Sale Price"/>
                            <h:outputText id="oldSalePrice" value="#{salesBean.currentBook.salePrice}" />
                        </div>
                        <div class="field">
                            <h:outputLabel for="newSalePrice" value="New Sale Price"/>
                            <h:inputText id="newSalePrice" label="New Sale Price" value="#{salesBean.newSalePrice}" required="true" requiredMessage="Please enter new sale price" a:placeholder="Enter new sale price" validator="#{salesBean.validatePrice}">
                                <f:ajax event="change" render="newSalePriceError"/>
                            </h:inputText>
                            <br/>
                            <h:message id="newSalePriceError" class="error" for="newSalePrice"/>
                        </div>
                    </div>
                    <br/>
                    <h:commandButton type="button" class="huge black fluid ui button" id="editBook" value="Edit Sale" action="#{salesBean.onSubmitEdit()}">
                        <f:ajax event="click" execute="newSalePrice" render="bookTable"/>
                    </h:commandButton>
                </h:form>
            </div>
        </div>
        <script>
            function hideGrowl() {
                $('#editFormGrowl').hide('slow');
            }
        </script>
    </h:body>
</html>
