<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"

      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:bookstore="http://java.sun.com/jsf/composite/default_components"
      xmlns:p="http://primefaces.org/ui"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
    <h:head>

        <title>The BookStore</title>
        <link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.min.css"/>

        <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&amp;display=swap" rel="stylesheet"/>

        <h:outputStylesheet library="webjars" name="Semantic-UI/2.4.1/semantic.min.css" />
        <h:outputStylesheet library="css" name="homepage.css" />

        <h:outputScript library="js" name="homepage.js" />

        <script  src="https://www.gstatic.com/charts/loader.js"></script>
        <script src="https://unpkg.com/swiper/js/swiper.min.js"></script>


    </h:head>
    <h:body>

        <!--<b:alert severity="info">{clientBacking.message}</b:alert>-->


        <!--composite component that comes from the navbar.xhtml file to avoid coding nav bar in all web pages-->
        <bookstore:navbar/>

        <!--Carousel that displays recently added books and their information-->
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <ui:repeat value="#{bb.recentlyAdded}" var="book">
                    <div class="swiper-slide item#{bb.bookSlideColor}">
                        <div class="sliderTextContent">
                            <h1>#{book.title}</h1>
                            <span>    <ui:repeat value="#{book.authorsCollection}" var="author">
                                    #{author.name}
                                </ui:repeat></span>
                            <p> #{book.description}</p>
                            <!--Button directs you to the book page for the current book being displayed in the carousel-->
                            <h:form>
                                <h:button  value="Shop Now" outcome="book" >
                                    <f:param  name="isbn" value="#{book.isbn}" /> 
                                </h:button>
                            </h:form>
                        </div>
                        <div  class="sliderImageContent">
                            <h:graphicImage width="300px" height="400px" library="images" name="#{book.isbn}.jpg"  />
                        </div>
                    </div>
                </ui:repeat>
            </div>




            <!-- Add Pagination -->
            <div class="swiper-pagination"></div>
            <!-- Add Arrows -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
        <div class="lightOrangeDiv">

            <!--Shows top eight books with that have been purchased most-->
            <p class="small">Best Seller Products</p><br/>
            <h:form>
                <h:panelGroup>
                    <div class="ui four doubling stackable cards">


                        <ui:repeat value="#{bb.bestSeller}" var="books">

                            <div class="ui fluid card darker homepageCard">
                                <div class="homepageImg">
                                    <h:graphicImage class="img" height="250" width="200" library="images" name="#{books.isbn}.jpg"/>
                                    <div class="cardHoverBtn"> View Cover</div>
                                </div>


                                <div class="content">

                                    <h:link outcome="book" value = "">
                                        <f:param  name="isbn" value="#{books.isbn}" /> 
                                        <div class="header textColor">

                                            #{books.title}</div>
                                        <div class="meta">

                                            <ui:repeat value="#{books.authorsCollection}" var="author">
                                                #{author.name}
                                            </ui:repeat>

                                        </div>

                                        <div class="description">
                                            <div class="ui tag labels">
                                                <a class="ui label">
                                                    $#{books.listPrice}
                                                </a>
                                            </div>

                                        </div>
                                    </h:link>



                                </div>

                                <!--Button to add to shopping cart-->
                                <div class="ui two bottom attached buttons ">
                                    <div onclick="addToCart(#{books.isbn}, 'pdf')" class="ui button">+ Add to Cart</div>



                                </div>
                            </div>
                        </ui:repeat>
                    </div>
                </h:panelGroup>
            </h:form>

            <br/><br/>

            <!--Search bar used searching for books that will display results in gallery page-->
            <form action="gallery.xhtml" method="get">
                <div class=" searchBarDiv">
                    <input placeholder="Search books..." type="text" name="query" style=" float: center; margin-top: -30px;" class="searchBar"/>
                    <input class="searchButton" type="submit" value = "Search"/>
                </div>
            </form>






            <!-- The Modal for view book cover -->
            <div id="myModal" class="modal">
                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">x</span>
                    <h:graphicImage class="image" id="img01" height="650px" width="520px" library="images" name="#{bb.book.isbn}.jpg"  />
                </div>
            </div>



        </div>


        <!-- Survey/Ad/News Section -->

        <div   class="lightGreyDiv">


            <!-- Shows the News -->


            <div class="ui three doubling stackable cards parentDiv">
                <div class="ui card" style="width:25%">
                    <div class="image">

                        <div style="background-color:#d77a61;" class="ui half page test ad left" data-text="">
                            <h3 style="color:white;padding-top: 10px;" >News</h3>
                            <p:scrollPanel style="overflow-y: scroll;height: 100%;">

                                <p:feedReader size="10" value="#{newsBean.randomNews.RSSFeed}" var="feed">
                                    <h:outputText value="#{feed.title}" style="font-weight: bold"/>
                                    <h:outputText value="#{feed.description.value}" escape="false"/>
                                    <p:separator />
                                    <f:facet name="error">
                                        Something went wrong.
                                    </f:facet>
                                </p:feedReader>  

                            </p:scrollPanel>

                        </div>

                    </div>
                </div>

                <div class="ui card" style="width:50%">
                    <div id="surveyDiv" class="content survey">


                        <!-- Survey Section -->
                        <h:form >
                            <p>#{ss.setSurvey()}</p>
                            <ui:repeat value="#{ss.survey}" var="s">
                                <h1 id="surveyStatus" style="text-align:center">  #{s.surveyName}</h1>
                                <!-- Shows the survey results once survey completed-->
                                <p id="surveyId" class="invisible">#{s.surveyID}</p>
                                <div id="results" class="invisible">

                                    <hr/>
                                   
                                    <p:chart responsive="true" id="barchart" type="bar"  model="#{surveyDataBacking.getBarChart(s.surveyID)}"  style="width:90%; height:90%;"/>
           
                                    <div class="ui horizontal statistics">
                                        <h:panelGroup id="other" >
                                            <ui:repeat  value="#{surveyDataBacking.getSurveyChoices(s.surveyID)}" var="sd">
                                                <div class="ui statistic">
                                                    <div class="value">#{sd.votes}</div>
                                                    <div class="label">#{sd.choice}</div>
                                                </div>
                                                <br/>
                                            </ui:repeat>
                                        </h:panelGroup>
                                    </div>
                                    <hr/>
                                    <h2>Thank you for answering!</h2>
                                </div>


                                <!-- Shows the actual survey-->
                                <div id="survey">
                                    <p style="font-size:20px;padding:2%">#{s.surveyDescription}</p>

                                    <p:selectOneRadio style="font-size:20px" required="true" layout="pageDirection" value="#{surveyDataBacking.surveyDataChoice}" >
                                        <f:selectItems value="#{s.surveyData}" var="sd" itemValue="#{sd.dataID}" itemLabel = " #{sd.choice}" />
                                    </p:selectOneRadio>
                                    <br/>
                                    <p:commandButton  update="other barchart" class="bookFormatBtn"  value="Submit" oncomplete="showResults(#{s.surveyID})"/>

                                </div>
                            </ui:repeat>
                        </h:form>

                    </div>  

                </div>



                <div class="ui card" style="width:10%">

                    <!-- First Ad location -->
                    <div class="image homepageCard">

                        <ui:repeat value="#{adsBean.randomAd}" var="ad">
                            <h:graphicImage height="100%" width="100%" library="images" name="#{ad.imageName}1.png"  onclick="viewAd('#{ad.adUrl}')"/>
                        </ui:repeat>


                    </div>
                </div>
            </div>



        </div>

        <!-- Shows the most popular book genres -->
        <div class="lightPurpleDiv">


            <p class="small">Popular Genres</p><br/>
            <h:form>
                <h:panelGroup>
                    <div class="ui four doubling stackable cards">
                        <ui:repeat value="#{bb.popularGenres}" var="genres">

                            <div class="ui fluid card darker">
                                <h:link outcome="gallery" value="">
                                    <f:param  name="genre" value="#{genres}" /> 
                                    <div class="homepageImg">
                                        <h:graphicImage class="img" height="100%" width="100%" library="images" name="#{genres}.jpg"/>
                                    </div>
                                    <div class="content">
                                        <div class="header"><h3 class="genre">#{genres}</h3></div>
                                    </div>
                                </h:link>
                            </div>
                        </ui:repeat>
                    </div>
                </h:panelGroup>
            </h:form>
            <br/><br/>

            <!-- Second Ad location -->
            <div class="ui one doubling stackable cards parentDiv">
                <div class="ui card" style="width:40%">
                    <div class="image">
                        <ui:repeat value="#{adsBean.randomAd}" var="ad">
                            <h:graphicImage height="100%" width="100%" library="images" name="#{ad.imageName}2.png" onclick="viewAd('#{ad.adUrl}')" />
                        </ui:repeat>
                    </div>

                </div>
            </div> 
        </div>

        <!--composite component that comes from the footer.xhtml file to avoid coding the website footer in all web pages-->
        <bookstore:footer/>

        <!-- Initialize Swiper -->
        <script>
            var swiper = new Swiper('.swiper-container', {
                loop: true,
                centeredSlides: true,
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
                pagination: {
                    el: '.swiper-pagination',
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
            });
        </script>
    </h:body>
</html>
